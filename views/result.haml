%script{:type=>"text/javascript", :src=>"/experiments/canvas-text/render.js"}
:javascript
  $(document).ready(function() {
    var prevent_xss = #{ @result.to_json };

    if(prevent_xss["png"] !== null) {
      renderPNG("attachment", prevent_xss["png"]);
      document.getElementById("pixels").innerHTML = prevent_xss["png"];
    } else {
      // fallback to trying to render pixels
      render("scratch", JSON.parse(prevent_xss["pixels"]));
      document.getElementById("pixels").innerHTML = JSON.stringify(JSON.parse(prevent_xss["pixels"])).replace(/,"/gi, ', "');
    }
  });

  function sendDelete() {
    var x = $.ajax( "#{ link_to(:result, @exp, @result) }", {
      "type": "DELETE",
      "success": function() { document.location = "#{ link_to(:results, @exp)}"; }
    });

  }

%nav
  %a{:href=>"/", :rel => "up"} Experiments
  &gt;
  %a{:href=>"#{link_to(:exp, @exp)}"} #{@exp.name}
  &gt;
  %a{:href=>"#{link_to(:results, @exp)}"} Results
  &gt;
  %b
    #{@result.id}

#experiment
  %h1
    Experiment
    %a{:href=>"#{link_to(:exp, @exp)}"} #{@exp.name}
  %h2 Result #{@result.id}
  - if not @result.title.nil?
    %h3 Title: #{@result.title}

  %h3 User Agent: #{@result.useragent}

  %p
    %a{:href=>"javascript:sendDelete()"} (delete)

  %p
    %a{:href=>"#{link_to(:diff, @exp, @result)}"} (diff)

  #attachment

  %p Pixels:
  #pixels

